import{d as L,e as E,f as y,q as S,u as C,o as l,h as c,w as r,x as B,i as m,k as p,l as s,b as M,t as x,a as U,F as z}from"./index-1833767a.js";const N={class:"ml-20 mr-20"},j=L({__name:"StreamRecorder",props:{stream:{default:void 0},video:{default:void 0}},setup(f){const _=f,{stream:u,video:w}=E(_),i=y(!1),a=y(),n=S([]),b=e=>{const o=new FileReader;o.onerror=t=>{console.error("媒体流转换到blob数据失败",t)},o.onloadend=()=>{},o.readAsBinaryString(e)},g=()=>{var e={mimeType:"video/webm;codecs=h264"};MediaRecorder.isTypeSupported(e.mimeType)||(console.log(e.mimeType+" is not Supported"),e={mimeType:"video/webm;codecs=vp9"},MediaRecorder.isTypeSupported(e.mimeType)||(console.log(e.mimeType+" is not Supported"),e={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(e.mimeType)||(console.log(e.mimeType+" is not Supported"),e={mimeType:"video/webm"},MediaRecorder.isTypeSupported(e.mimeType)||(console.log(e.mimeType+" is not Supported"),e={mimeType:""}))));try{u.value&&(a.value=new MediaRecorder(u.value,e),n.length=0,console.log("Created MediaRecorder",a.value,"with options",e),a.value.addEventListener("start",function(o){console.log("Recorder start ..."),i.value=!0}),a.value.addEventListener("stop",function(o){console.log("Recorder stopped: ",o),i.value=!1}),a.value.addEventListener("error",function(o){console.error("media recorder error",o),i.value=!1}),a.value.addEventListener("dataavailable",function(o){o.data&&o.data.size>0&&(b(o.data),n.push(o.data))}),a.value.start(10),console.log("MediaRecorder started",a.value))}catch(o){alert(`Exception while creating MediaRecorder: ${o}. mimeType: ${e.mimeType}`)}},T=()=>{a.value&&i.value&&(i.value=!1,a.value.stop())},R=()=>{if(n&&n.length){const e=new Blob(n,{type:"video/webm"}),o=window.URL.createObjectURL(e),t=document.createElement("a");t.style.display="none",t.href=o,t.download="Rec_"+Date.now()+".webm",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),window.URL.revokeObjectURL(o)},100)}},h=()=>{const e=w.value;if(e){const o=function(){e.currentTime=0,e.play()},t=function(d){console.log("loadedmetadata",e.currentTime,e.duration),e.duration===1/0&&(e.currentTime=1e101,e.addEventListener("timeupdate",o))};e.removeEventListener("timeupdate",o),e.removeEventListener("loadedmetadata",t),e.addEventListener("loadedmetadata",t)}if(n&&n.length){const o=new Blob(n,{type:"video/webm"}),t=window.URL.createObjectURL(o);window.open(t)}};return(e,o)=>{const t=m("el-tag"),d=m("el-button"),v=m("el-col"),k=m("el-row");return C(u)?(l(),c(k,{key:0},{default:r(()=>[i.value?(l(),c(v,{key:0},{default:r(()=>[p(t,{type:"danger"},{default:r(()=>[s("Rec ....")]),_:1}),M("small",N,x(n.length),1),p(d,{type:"danger",size:"mini",onClick:T},{default:r(()=>[s("停止录制")]),_:1})]),_:1})):(l(),c(v,{key:1},{default:r(()=>[n.length?(l(),U(z,{key:0},[p(d,{type:"primary",size:"mini",onClick:h},{default:r(()=>[s("预览")]),_:1}),p(d,{type:"danger",size:"mini",onClick:R},{default:r(()=>[s("下载视频")]),_:1})],64)):(l(),c(d,{key:1,type:"success",size:"mini",onClick:g},{default:r(()=>[s("开始录制")]),_:1}))]),_:1}))]),_:1})):B("",!0)}}});export{j as _};
