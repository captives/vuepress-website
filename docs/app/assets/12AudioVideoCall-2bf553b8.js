import{_ as x}from"./WebRTC.vue_vue_type_script_setup_true_lang-933a8b67.js";import{S as g}from"./StreamPlayer-0a851912.js";import{S as h}from"./StreamTracks-c1359b8a.js";import{d as T,f as u,s as P,o as E,h as R,w as r,k as n,l as C,i as m}from"./index-1833767a.js";const V=T({__name:"12AudioVideoCall",setup(y){const f=u(),l=u(),i=u();let p={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},t,o;const w=(e,a)=>{var c;console.log("stream player completed",e),(c=f.value)==null||c.getUserMedia({audio:!0,video:{width:{exact:720},height:{exact:405}}})},_=(e,a,c,s)=>{a.addIceCandidate(e).then(()=>{console.log("AddIceCandidate success.")}).catch(function(d){console.log("Failed to add ICE candidate: "+d.toString())}),console.log(c+"New "+s+" ICE candidate: "+(e?e.candidate:"(null)"))},S=()=>{t=new RTCPeerConnection(p),l.value.getTracks().forEach(e=>{t.addTrack(e,l.value)}),t.addEventListener("icecandidate",e=>{e.candidate&&o&&_(e.candidate,o,"localPeer#:","local")}),t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(e=>{t.setLocalDescription(e),console.log(`Offer from publisherPeerConnection 
`+e.sdp),o.setRemoteDescription(e),o.createAnswer().then(a=>{o.setLocalDescription(a),console.log(`Answer from subscriberPeerConnection 
${a.sdp}`),t.setRemoteDescription(a)}).catch(function(a){console.log(`Failed to create session description: ${a.toString()}`)})}).catch(function(e){console.log(`Failed to create session description: ${e.toString()}`)})},b=()=>{o=new RTCPeerConnection(p),o.addEventListener("icecandidate",function(e){e.candidate&&t&&_(e.candidate,t,"remotePeer#:","remote")}),o.addEventListener("track",function(e){i.value=e.streams[0],console.log("received remote stream",e.streams)})},k=e=>{l.value=e,S(),b()};return P(()=>{t==null||t.close(),o==null||o.close()}),(e,a)=>{const c=m("el-divider"),s=m("el-col"),d=m("el-row");return E(),R(x,{ref_key:"webrtc",ref:f,title:"动态选择用户设备",onCompleted:w,onStream:k},{video:r(({stream:v})=>[n(d,{gutter:50},{default:r(()=>[n(s,{class:"center",xs:24,sm:24,md:12},{default:r(()=>[n(c,{"content-position":"left"},{default:r(()=>[C("Publisher")]),_:1}),n(g,{stream:v,autoplay:"",controls:!1},null,8,["stream"]),n(h,{value:v},null,8,["value"])]),_:2},1024),n(s,{class:"center",xs:24,sm:24,md:12},{default:r(()=>[n(c,{"content-position":"left"},{default:r(()=>[C("Subscriber")]),_:1}),n(g,{stream:i.value,autoplay:"",controls:!1},null,8,["stream"]),n(h,{value:i.value},null,8,["value"])]),_:1})]),_:2},1024)]),_:1},512)}}});export{V as default};
