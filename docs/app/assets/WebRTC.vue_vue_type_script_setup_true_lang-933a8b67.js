import{d as B,e as C,f as i,q as p,s as L,o as O,a as V,b as D,t as F,u as N,r as g,F as R,x as T,y as q,z as w}from"./index-1833767a.js";const z=[".srcObject"],A=B({__name:"WebRTC",props:{title:{default:""}},emits:["error","ready","completed","stream","add","remove","change"],setup(M,{expose:y,emit:o}){const U=M,{appendScript:k}=q,S=w("oss"),{title:E}=C(U),m=i(!1),s=i(),l=i(!1),r=i(!1),t=i(),n=p([]),c=p([]),d=p([]),u=p([]),h=()=>{var e;s.value=void 0,(e=t.value)==null||e.getTracks().forEach(a=>{a.stop()}),t.value=void 0,console.log("rtc closed !")},_=e=>{n.splice(0,n.length,...e),c.splice(0,c.length,...e.filter(a=>a.kind==="audioinput")),d.splice(0,d.length,...e.filter(a=>a.kind==="audiooutput")),u.splice(0,u.length,...e.filter(a=>a.kind==="videoinput")),h(),o("completed",n,{audioInput:c,audioOutput:d,videoInput:u})},v=e=>{console.log("Error #",e),s.value=e,o("error",e)},f=e=>{e.addEventListener("inactive",()=>{console.log("Stream inactive")}),e.addEventListener("active",()=>{console.log("Stream active")})},b=(e={audio:!0,video:!0})=>{s.value=void 0,navigator.mediaDevices.getUserMedia(e).then(a=>{console.log("localstream",a),f(a),t.value=a,o("stream",a)}).catch(v)},j=(e={audio:!0,video:!0})=>{s.value=void 0,r.value&&navigator.mediaDevices.getDisplayMedia(e).then(a=>{t.value=a}).catch(v)},$=()=>{l.value="getUserMedia"in navigator.mediaDevices,r.value="getDisplayMedia"in navigator.mediaDevices,l.value&&navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(e=>(console.log("localstream",e),f(e),t.value=e,o("stream",e),navigator.mediaDevices.enumerateDevices())).then(_).catch(v)};return k(S("wertc-adapter/adapter.js")).then(e=>{m.value=!!e,o("ready",m.value),navigator.mediaDevices&&$()}).catch(e=>v),L(()=>h()),y({close:h,getUserMedia:b,getDisplayMedia:j}),(e,a)=>m.value?(O(),V(R,{key:0},[D("h3",null,F(N(E)),1),g(e.$slots,"list",{list:n,data:{audioInput:c,audioOutput:d,videoInput:u},support:{supUserMedia:l.value,supDisplayMedia:r.value}}),g(e.$slots,"video",{stream:t.value},()=>[D("video",{ref:"localVideo",".srcObject":t.value,autoplay:""},null,8,z)]),g(e.$slots,"default"),g(e.$slots,"error",{data:{error:s.value,supUserMedia:l.value,supDisplayMedia:r.value}})],64)):T("",!0)}});export{A as _};
