import{S as C}from"./StreamPlayer-0a851912.js";import{S as w}from"./StreamTracks-c1359b8a.js";import{_ as S}from"./MediaError.vue_vue_type_script_setup_true_lang-7241cc78.js";import{d as v,f as h,o as x,a as g,k as c,b as m,F as q,i as _,_ as z}from"./index-1833767a.js";import"./webrtc-841bc7c7.js";var p=308,o=231,V=.8,B=2048;function l(a,s){console.log("Creating StreamVisualizer with stream and canvas: ",a,s),this.canvas=s,window.addEventListener("resize",this.resize.bind(this),!1),this.resize(),this.drawContext=this.canvas.getContext("2d"),typeof AudioContext=="function"?this.context=new AudioContext:typeof webkitAudioContext=="function"?this.context=new webkitAudioContext:alert("Sorry! Web Audio is not supported by this browser"),this.source=this.context.createMediaStreamSource(a),console.log("Created Web Audio source from remote stream: ",this.source),this.analyser=this.context.createAnalyser(),this.analyser.minDecibels=-140,this.analyser.maxDecibels=0,this.freqs=new Uint8Array(this.analyser.frequencyBinCount),this.times=new Uint8Array(this.analyser.frequencyBinCount),this.source.connect(this.analyser),this.startTime=0,this.startOffset=0}l.prototype.resize=function(){var a;if(this.canvas){const s=(a=this.canvas.parentElement)==null?void 0:a.getBoundingClientRect();s&&(p=s.width,o=s.height,this.canvas.width=s.width,this.canvas.height=s.height,this.canvas.style.width=s.width+"px",this.canvas.style.height=s.height+"px")}};l.prototype.start=function(){requestAnimationFrame(this.draw.bind(this))};l.prototype.draw=function(){this.analyser.smoothingTimeConstant=V,this.analyser.fftSize=B,this.analyser.getByteFrequencyData(this.freqs),this.analyser.getByteTimeDomainData(this.times),this.canvas.width=p,this.canvas.height=o;for(var a=0;a<this.analyser.frequencyBinCount;a++){var s=this.freqs[a],r=s/256,e=o*r,n=o-e-1,i=p/this.analyser.frequencyBinCount,u=a/this.analyser.frequencyBinCount*360;this.drawContext.fillStyle="hsl("+u+", 100%, 50%)",this.drawContext.fillRect(a*i,n,i,e)}for(a=0;a<this.analyser.frequencyBinCount;a++)s=this.times[a],r=s/256,e=o*r,n=o-e-1,i=p/this.analyser.frequencyBinCount,this.drawContext.fillStyle="white",this.drawContext.fillRect(a*i,n,1,2);requestAnimationFrame(this.draw.bind(this))};l.prototype.getFrequencyValue=function(a){var s=this.context.sampleRate/2,r=Math.round(a/s*this.freqs.length);return this.freqs[r]};const b={class:"container"},A=v({__name:"08MediaStreamVisualizer",setup(a){const s=h(),r=h(""),e=h(),n=h(),i=(u,t)=>{t!=null&&t.captureStream||t!=null&&t.mozCaptureStream,t!=null&&t.captureStream?e.value=t==null?void 0:t.captureStream(0):t!=null&&t.mozCaptureStream?e.value=t==null?void 0:t.mozCaptureStream(0):(console.error("Stream capture is not supported"),e.value=void 0),new l(e.value,n.value).start(),console.log("Capture stream",e.value)};return(u,t)=>{const y=_("URLInput"),f=_("VideoPlayer");return x(),g(q,null,[c(y,{list:u.$videoList,modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=d=>r.value=d)},null,8,["list","modelValue"]),c(f,{src:u.$oss(r.value),class:"mt-20",autoplay:"",loop:"",onCanplay:i},null,8,["src"]),c(C,{stream:e.value,class:"mt-20",muted:"",autoplay:!0},null,8,["stream"]),m("div",b,[m("canvas",{ref_key:"canvas",ref:n,calss:"canvas"},null,512)]),c(w,{value:e.value,class:"mt-20"},null,8,["value"]),c(S,{error:s.value},null,8,["error"])],64)}}});const M=z(A,[["__scopeId","data-v-19eba501"]]);export{M as default};
